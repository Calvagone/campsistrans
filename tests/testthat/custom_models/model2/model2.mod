
$PROB run_psn_duplicate_vars

$INPUT blabla

$DATA ID

$SUBR    ADVAN13 TOL=9

$MODEL
        COMP=(DEPOT,DEFDOSE)
        COMP=(CENTRAL,DEFOBS)

$ABBR PROTECT

$PK
; Time-varying covariate initiation
IF (NEWIND.NE.2) MY_AST=AST

;;; CLAST-DEFINITION START
   CLAST = ((MY_AST/40)**THETA(12))
;;; CLAST-DEFINITION END

;;; CL-RELATION START
CLCOV=CLAST
;;; CL-RELATION END


;;; BIOBBILTOT-DEFINITION START
   BIOBBILTOT = ((BBILTOT/0.80)**THETA(11))
;;; BIOBBILTOT-DEFINITION END


;;; BIOAST-DEFINITION START
   BIOAST = ((MY_AST/40)**THETA(10))
;;; BIOAST-DEFINITION END

;;; BIO-RELATION START
BIOCOV=BIOAST*BIOBBILTOT
;;; BIO-RELATION END


; Parameter mapping start
; thetas
TVBIO = THETA(1)

TVBIO = BIOCOV*TVBIO
TVLAG = THETA(2)
TVKA = THETA(3)
TVCLMAX = THETA(4)
TVVC = THETA(5)
TVT50 = THETA(6)
GAM = THETA(7)
addRUV = THETA(8)
propRUV = THETA(9)
 
; etas
ETA_BIO = ETA(1)
ETA_LAG = ETA(2)
ETA_KA = ETA(3)

ETA_CL = ETA(4)
ETA_VC = ETA(5)
ETA_T50= ETA(6)
; Parameter mapping end

; Parameter definitions 
BIO   = TVBIO* EXP(ETA_BIO)
LAG   = TVLAG* EXP(ETA_LAG)
KA    = TVKA * EXP(ETA_KA)
CLMAX = TVCLMAX
T50   = TVT50 * EXP(ETA_T50)


VC    = TVVC * EXP(ETA_VC) * (BWT/70)**1

; Nonmem specific names
F1    = BIO
ALAG1 = LAG
V     = VC
S2    = VC

MY_AST=AST

$DES
TVCL  = 0.001 + CLMAX * (T+TXREF)**GAM/((T+TXREF)**GAM + T50**GAM)
CL    = TVCL * CLCOV * EXP(ETA_CL) * (BWT/70)**0.75
KE = CL/VC

DADT(DEPOT) = -KA*A(DEPOT)
DADT(CENTRAL) = KA*A(DEPOT) - KE*A(CENTRAL)

$ERROR
IPRED = F
W     = SQRT(propRUV**2*IPRED**2 + addRUV**2)
Y     = IPRED + W*EPS(1)
IRES  = DV-IPRED
IWRES = IRES/W

$THETA
1 FIX ; TVBIO
0 FIX ; TVLAG; h
1.412 FIX ; TVKA; 1/h
(0,10) ; TVCLMAX; L/h
(0,1000) ; TVVC; L
(0,40) ; T50; h
(0,3) ; GAM
(0,1) ; addRUV
(0,0.20) ; propRUV
(-100,0.1,100000) ; BIOAST1
(-100,0.1,100000) ; BIOBBILTOT1
(-100,0.1,100000) ; CLAST1

$OMEGA
0  FIX  ;    IIV_BIO
0  FIX  ;    IIV_LAG
0  FIX  ;     IIV_KA

$OMEGA BLOCK(3)
0.322989571281321  ;     IIV_CL
0.202827148114647 
0.280951738161245  ;     IIV_VC
0.081922943893194 
0.086833979385528 
0.519911757437828  ;    IIV_T50

$SIGMA
1  FIX


$ESTIMATION PRINT=5 MAXEVAL=9999 SADDLE_RESET=1 NOABORT NSIG=4 SIGL=12
            METHOD=COND INTER NOOBT NOTBT NOSBT
$COVARIANCE PRINT=E UNCONDITIONAL 
