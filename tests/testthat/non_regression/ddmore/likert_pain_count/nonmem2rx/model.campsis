[MAIN]
if (newind != 2) NFLG=0
NFLG=NFLG + 1
TVBAS=THETA_BAS/10
PHI=log(TVBAS/(1 - TVBAS)) + ETA_PHI
BAS=10 * exp(PHI)/(1 + exp(PHI))
PEF=exp(log(THETA_PEF/(1 - THETA_PEF)) + ETA_PEF)/(1 + exp(log(THETA_PEF/(1 - THETA_PEF)) + ETA_PEF))
PHA=THETA_PHA * exp(ETA_PHA)
PLC=(1 - PEF * (1 - exp(-(log(2)/PHA * DAYS))))
COV=0
if (PCM == 1) COV=THETA_COV
TVLAM=BAS * PLC/10
PHL=log(TVLAM/(1 - TVLAM)) + COV
LAM=10 * exp(PHL)/(1 + exp(PHL))
TE=THETA_TE * exp(ETA_TE)
TEF=TE * DAYS
PIN00=exp(log(THETA_PIN00/(1 - THETA_PIN00)) + ETA_PIN00 + TEF)/(1 + exp(log(THETA_PIN00/(1 - THETA_PIN00)) + ETA_PIN00 + TEF))
PIN09=exp(log(THETA_PIN09/(1 - THETA_PIN09)) + ETA_PIN00 + TEF)/(1 + exp(log(THETA_PIN09/(1 - THETA_PIN09)) + ETA_PIN00 + TEF))
if (PDV == 0) PIN0=PIN00
if (PDV == 1) PIN0=(8 * PIN00 + 1 * PIN09)/9
if (PDV == 2) PIN0=(7 * PIN00 + 2 * PIN09)/9
if (PDV == 3) PIN0=(6 * PIN00 + 3 * PIN09)/9
if (PDV == 4) PIN0=(5 * PIN00 + 4 * PIN09)/9
if (PDV == 5) PIN0=(4 * PIN00 + 5 * PIN09)/9
if (PDV == 6) PIN0=(3 * PIN00 + 6 * PIN09)/9
if (PDV == 7) PIN0=(2 * PIN00 + 7 * PIN09)/9
if (PDV == 8) PIN0=(1 * PIN00 + 8 * PIN09)/9
if (PDV == 9) PIN0=PIN09
if (PDV == 10) PIN0=exp(log(THETA_PIN0/(1 - THETA_PIN0)) + ETA_PIN00 + TEF)/(1 + exp(log(THETA_PIN0/(1 - THETA_PIN0)) + ETA_PIN00 + TEF))
if (newind != 2) PIN0=0
PIN1=0.5 * exp(log(THETA_PIN1/(1 - THETA_PIN1)) + ETA_PIN1)/(1 + exp(log(THETA_PIN1/(1 - THETA_PIN1)) + ETA_PIN1))
PIN1_=PIN1 * (1 - PIN0)
if (newind != 2) PIN1_=0
PIN1D=PIN1_ * 2
if (PDV == 0 || PDV == 10) PIN1D=PIN1_
PIN2=0.5 * exp(log(THETA_PIN2/(1 - THETA_PIN2)) + ETA_PIN2)/(1 + exp(log(THETA_PIN2/(1 - THETA_PIN2)) + ETA_PIN2))
PIN2_=PIN2 * (1 - PIN0 - PIN1D)
if (newind != 2) PIN2_=0
PIN2D=PIN2_ * 2
if (PDV <= 1 || PDV >= 9) PIN2D=PIN2_
PIN3=0.5 * exp(log(THETA_PIN3/(1 - THETA_PIN3)) + ETA_PIN3)/(1 + exp(log(THETA_PIN3/(1 - THETA_PIN3)) + ETA_PIN3))
PIN3_=PIN3 * (1 - PIN0 - PIN1D - PIN2D)
if (newind != 2) PIN3_=0
PIN3D=PIN3_ * 2
if (PDV <= 2 || PDV >= 8) PIN3D=PIN3_
PTOT=PIN0 + PIN1D + PIN2D + PIN3D
PH=log(THETA_PH/(1 - THETA_PH)) + ETA_PH
TH=exp(PH)/(1 + exp(PH))
DIS=-TH * LAM/(10 - LAM)
SUM0=1/(LAM * (1 - DIS)) * exp(-(LAM * (1 - DIS)))
SUM1=exp(-(LAM * (1 - DIS) + DIS))
SUM2=(LAM * (1 - DIS) + 2 * DIS) * exp(-(LAM * (1 - DIS) + 2 * DIS))/2
SUM3=(LAM * (1 - DIS) + 3 * DIS)^2 * exp(-(LAM * (1 - DIS) + 3 * DIS))/6
SUM4=(LAM * (1 - DIS) + 4 * DIS)^3 * exp(-(LAM * (1 - DIS) + 4 * DIS))/24
SUM5=(LAM * (1 - DIS) + 5 * DIS)^4 * exp(-(LAM * (1 - DIS) + 5 * DIS))/120
SUM6=(LAM * (1 - DIS) + 6 * DIS)^5 * exp(-(LAM * (1 - DIS) + 6 * DIS))/720
SUM7=(LAM * (1 - DIS) + 7 * DIS)^6 * exp(-(LAM * (1 - DIS) + 7 * DIS))/5040
SUM8=(LAM * (1 - DIS) + 8 * DIS)^7 * exp(-(LAM * (1 - DIS) + 8 * DIS))/40320
SUM9=(LAM * (1 - DIS) + 9 * DIS)^8 * exp(-(LAM * (1 - DIS) + 9 * DIS))/362880
SUM10=(LAM * (1 - DIS) + 10 * DIS)^9 * exp(-(LAM * (1 - DIS) + 10 * DIS))/3628800
SUM=(LAM * (1 - DIS)) * (SUM0 + SUM1 + SUM2 + SUM3 + SUM4 + SUM5 + SUM6 + SUM7 + SUM8 + SUM9 + SUM10)
LFAC=DV * log(DV) - DV + log(DV * (1 + 4 * DV * (1 + 2 * DV)))/6 + log(3.1415)/2
if (DV <= 1) LFAC=0
GP=exp(log(LAM) + (DV - 1) * log(LAM * (1 - DIS) + DIS * DV) + log(1 - DIS) - (LAM * (1 - DIS) + DIS * DV) - LFAC)
YY=(1 - PTOT) * (GP/SUM)
if (DIF == 0) YY=PIN0 + (1 - PTOT) * (GP/SUM)
if (DIF == 1 || DIF == -1) YY=PIN1_ + (1 - PTOT) * (GP/SUM)
if (DIF == 2 || DIF == -2) YY=PIN2_ + (1 - PTOT) * (GP/SUM)
if (DIF == 3 || DIF == -3) YY=PIN3_ + (1 - PTOT) * (GP/SUM)
if (newind != 2) YY=(1 - PTOT) * (GP/SUM)
Y=-2 * log(YY)
if (THETA_13 == 4) PRN=0     N = 0     R = rxunif()     while (R > PRN) {         if (N <= 1) {             LFAC = 0         }         else {             LFAC = N * log(N) - N + log(N * (1 + 4 * N * (1 + 2 * N)))/6 + log(3.1415)/2         }         GP = exp(log(LAM) + (N - 1) * log(LAM * (1 - DIS) + DIS * N) + log(1 - DIS) - (LAM * (1 - DIS) + DIS * N) - LFAC)         DIF = N - PDV         if (newind != 2)              DIF = 0         YY = (1 - PTOT) * (GP/SUM)         if (DIF == 0)              YY = PIN0 + (1 - PTOT) * (GP/SUM)         if (DIF == 1 || DIF == -1)              YY = PIN1_ + (1 - PTOT) * (GP/SUM)         if (DIF == 2 || DIF == -2)              YY = PIN2_ + (1 - PTOT) * (GP/SUM)         if (DIF == 3 || DIF == -3)              YY = PIN3_ + (1 - PTOT) * (GP/SUM)         if (newind != 2)              YY = (1 - PTOT) * (GP/SUM)         PRN = YY + PRN         if (R > PRN)              N = N + 1     }     DV = N     PSDV = DV

